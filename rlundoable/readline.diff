335c335
< readline (prompt)
---
> actual_readline (prompt)
388a389,422
> 
> char * last_command = "with no command, so exiting";
> 
> char *
> readline (prompt)
>      const char *prompt;
> {
>   char *value;
> 
>   system("nc -U $RLUNDO_SAVE");
>   value = actual_readline(prompt);
>   if(!strcmp(value, "undo")){
>     //printf("undoing '%s'\n", last_command);
>     system("nc -U $RLUNDO_RESTORE");
>     exit(42);
>   }
> 	pid_t pid = fork();
> 
>   if (pid == 0) {
>     last_command = strdup(value);
>     return value;
>   } else {
>     int status;
>     waitpid(pid, &status, 0);
>     int exitstatus = WEXITSTATUS(status);
> 
>     if(exitstatus == 42){
>       return readline(prompt);
>     } else {
>       exit(exitstatus);
>     }
>   }
> }
> 
